!function(t){"function"==typeof define&&define.amd?define(["jquery","jquery-ui/sortable"],t):t(jQuery)}(function(t){function e(t,e,s){return t>e&&e+s>t}t.widget("mjs.nestedSortable",t.extend({},t.ui.sortable.prototype,{options:{disableParentChange:!1,doNotClear:!1,expandOnHover:700,isAllowed:function(){return!0},isTree:!1,listType:"ol",maxLevels:0,protectRoot:!1,rootID:null,rtl:!1,startCollapsed:!1,tabSize:20,branchClass:"mjs-nestedSortable-branch",collapsedClass:"mjs-nestedSortable-collapsed",disableNestingClass:"mjs-nestedSortable-no-nesting",errorClass:"mjs-nestedSortable-error",expandedClass:"mjs-nestedSortable-expanded",hoveringClass:"mjs-nestedSortable-hovering",leafClass:"mjs-nestedSortable-leaf",disabledClass:"mjs-nestedSortable-disabled"},_create:function(){if(this.element.data("ui-sortable",this.element.data("mjs-nestedSortable")),!this.element.is(this.options.listType))throw new Error("nestedSortable: Please check that the listType option is set to your actual list type");if(this.options.isTree&&this.options.expandOnHover&&(this.options.tolerance="intersect"),t.ui.sortable.prototype._create.apply(this,arguments),this.options.isTree){var e=this;t(this.items).each(function(){var t=this.item;t.children(e.options.listType).length?(t.addClass(e.options.branchClass),t.hasClass(e.options.collapsedClass)||t.hasClass(e.options.expandedClass)||t.addClass(e.options.startCollapsed?e.options.collapsedClass:e.options.expandedClass)):t.addClass(e.options.leafClass)})}},_destroy:function(){return this.element.removeData("mjs-nestedSortable").removeData("ui-sortable"),t.ui.sortable.prototype._destroy.apply(this,arguments)},_mouseDrag:function(e){var s,i,o,n,a=this.options,l=!1;this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=l=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=l=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=l=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=l=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-t(document).scrollTop()<a.scrollSensitivity?l=t(document).scrollTop(t(document).scrollTop()-a.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<a.scrollSensitivity&&(l=t(document).scrollTop(t(document).scrollTop()+a.scrollSpeed)),e.pageX-t(document).scrollLeft()<a.scrollSensitivity?l=t(document).scrollLeft(t(document).scrollLeft()-a.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<a.scrollSensitivity&&(l=t(document).scrollLeft(t(document).scrollLeft()+a.scrollSpeed))),l!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute");var r=this.placeholder.offset().top;this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),this.hovering=this.hovering?this.hovering:null,this.mouseentered=this.mouseentered?this.mouseentered:!1;var h=this.placeholder[0].parentNode.parentNode&&t(this.placeholder[0].parentNode.parentNode).closest(".ui-sortable").length?t(this.placeholder[0].parentNode.parentNode):null,d=this._getLevel(this.placeholder),c=this._getChildLevels(this.helper),p=document.createElement(a.listType);for(s=this.items.length-1;s>=0;s--)if(i=this.items[s],o=i.item[0],n=this._intersectsWithPointer(i),n&&i.instance===this.currentContainer){if(-1!==o.className.indexOf(a.disabledClass))if(2===n){var u=this.items[s+1];if(u&&-1!==u.item[0].className.indexOf(a.disabledClass))continue}else if(1===n){var m=this.items[s-1];if(m&&-1!==m.item[0].className.indexOf(a.disabledClass))continue}if(o!==this.currentItem[0]&&this.placeholder[1===n?"next":"prev"]()[0]!==o&&!t.contains(this.placeholder[0],o)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],o):!0)){if(this.mouseentered||(t(o).mouseenter(),this.mouseentered=!0),a.isTree&&t(o).hasClass(a.collapsedClass)&&a.expandOnHover&&!this.hovering){t(o).addClass(a.hoveringClass);var f=this;this.hovering=window.setTimeout(function(){t(o).removeClass(a.collapsedClass).addClass(a.expandedClass),f.refreshPositions(),f._trigger("expand",e,f._uiHash())},a.expandOnHover)}if(this.direction=1==n?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(i))break;if(t(o).mouseleave(),this.mouseentered=!1,t(o).removeClass(a.hoveringClass),this.hovering&&window.clearTimeout(this.hovering),this.hovering=null,!a.protectRoot||this.currentItem[0].parentNode==this.element[0]&&o.parentNode!=this.element[0])a.protectRoot||this._rearrange(e,i);else if(this.currentItem[0].parentNode!=this.element[0]&&o.parentNode==this.element[0]){t(o).children(a.listType).length||(o.appendChild(p),a.isTree&&t(o).removeClass(a.leafClass).addClass(a.branchClass+" "+a.expandedClass));var g="down"===this.direction?t(o).prev().children(a.listType):t(o).children(a.listType);void 0!==g[0]&&this._rearrange(e,null,g)}else this._rearrange(e,i);this._clearEmpty(o),this._trigger("change",e,this._uiHash());break}}var v=this.placeholder[0].previousSibling?t(this.placeholder[0].previousSibling):null;if(null!=v)for(;"li"!=v[0].nodeName.toLowerCase()||-1!==v[0].className.indexOf(a.disabledClass)||v[0]==this.currentItem[0]||v[0]==this.helper[0];){if(!v[0].previousSibling){v=null;break}v=t(v[0].previousSibling)}var b=this.placeholder[0].nextSibling?t(this.placeholder[0].nextSibling):null;if(null!=b)for(;"li"!=b[0].nodeName.toLowerCase()||-1!==b[0].className.indexOf(a.disabledClass)||b[0]==this.currentItem[0]||b[0]==this.helper[0];){if(!b[0].nextSibling){b=null;break}b=t(b[0].nextSibling)}return this.beyondMaxLevels=0,null==h||null!=b||a.protectRoot&&h[0].parentNode==this.element[0]||!(a.rtl&&this.positionAbs.left+this.helper.outerWidth()>h.offset().left+h.outerWidth()||!a.rtl&&this.positionAbs.left<h.offset().left)?null==v||v.hasClass(a.disableNestingClass)||!(v.children(a.listType).length&&v.children(a.listType).is(":visible")||!v.children(a.listType).length)||a.protectRoot&&this.currentItem[0].parentNode==this.element[0]||!(a.rtl&&this.positionAbs.left+this.helper.outerWidth()<v.offset().left+v.outerWidth()-a.tabSize||!a.rtl&&this.positionAbs.left>v.offset().left+a.tabSize)?this._isAllowed(h,d,d+c):(this._isAllowed(v,d,d+c+1),v.children(a.listType).length||(v[0].appendChild(p),a.isTree&&v.removeClass(a.leafClass).addClass(a.branchClass+" "+a.expandedClass)),r&&r<=v.offset().top?v.children(a.listType).prepend(this.placeholder):v.children(a.listType)[0].appendChild(this.placeholder[0]),this._trigger("change",e,this._uiHash())):(h.after(this.placeholder[0]),a.isTree&&h.children(a.listItem).children("li:visible:not(.ui-sortable-helper)").length<1&&h.removeClass(this.options.branchClass+" "+this.options.expandedClass).addClass(this.options.leafClass),this._clearEmpty(h[0]),this._trigger("change",e,this._uiHash())),this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e){this.beyondMaxLevels&&(this.placeholder.removeClass(this.options.errorClass),this.domPosition.prev?t(this.domPosition.prev).after(this.placeholder):t(this.domPosition.parent).prepend(this.placeholder),this._trigger("revert",e,this._uiHash())),t("."+this.options.hoveringClass).mouseleave().removeClass(this.options.hoveringClass),this.mouseentered=!1,this.hovering&&window.clearTimeout(this.hovering),this.hovering=null,t.ui.sortable.prototype._mouseStop.apply(this,arguments);var s=t(this.domPosition.parent).parent().attr("id"),i=this.domPosition.prev?t(this.domPosition.prev).next().index():0;(s!=this._uiHash().item.parent().parent().attr("id")||i!=this._uiHash().item.index())&&this._trigger("relocate",e,this._uiHash())},_intersectsWithSides:function(t){var s=this.options.isTree?.8:.5,i=e(this.positionAbs.top+this.offset.click.top,t.top+t.height*s,t.height),o=e(this.positionAbs.top+this.offset.click.top,t.top-t.height*s,t.height),n=e(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),a=this._getDragVerticalDirection(),l=this._getDragHorizontalDirection();return this.floating&&l?"right"==l&&n||"left"==l&&!n:a&&("down"==a&&i||"up"==a&&o)},_contactContainers:function(){this.options.protectRoot&&this.currentItem[0].parentNode==this.element[0]||t.ui.sortable.prototype._contactContainers.apply(this,arguments)},_clear:function(){t.ui.sortable.prototype._clear.apply(this,arguments);for(var e=this.items.length-1;e>=0;e--){var s=this.items[e].item[0];this._clearEmpty(s)}},serialize:function(e){var s=t.extend({},this.options,e),i=this._getItemsAsjQuery(s&&s.connected),o=[];return t(i).each(function(){var e=(t(s.item||this).attr(s.attribute||"id")||"").match(s.expression||/(.+)[-=_](.+)/),i=(t(s.item||this).parent(s.listType).parent(s.items).attr(s.attribute||"id")||"").match(s.expression||/(.+)[-=_](.+)/);e&&o.push((s.key||e[1])+"["+(s.key&&s.expression?e[1]:e[2])+"]="+(i?s.key&&s.expression?i[1]:i[2]:s.rootID))}),!o.length&&s.key&&o.push(s.key+"="),o.join("&")},toHierarchy:function(e){function s(e){var o=(t(e).attr(i.attribute||"id")||"").match(i.expression||/(.+)[-=_](.+)/);if(o){var n={id:o[2]};return t(e).children(i.listType).children(i.items).length>0&&(n.children=[],t(e).children(i.listType).children(i.items).each(function(){var t=s(this);n.children.push(t)})),n}}var i=t.extend({},this.options,e),o=(i.startDepthCount||0,[]);return t(this.element).children(i.items).each(function(){var t=s(this);o.push(t)}),o},toArray:function(e){function s(e,a,l){var r,h,d=l+1;if(t(e).children(i.listType).children(i.items).length>0&&(a++,t(e).children(i.listType).children(i.items).each(function(){d=s(t(this),a,d)}),a--),r=t(e).attr(i.attribute||"id").match(i.expression||/(.+)[-=_](.+)/),a===o+1)h=i.rootID;else{var c=t(e).parent(i.listType).parent(i.items).attr(i.attribute||"id").match(i.expression||/(.+)[-=_](.+)/);h=c[2]}return r&&n.push({item_id:r[2],parent_id:h,depth:a,left:l,right:d}),l=d+1}var i=t.extend({},this.options,e),o=i.startDepthCount||0,n=[],a=1;return i.excludeRoot||(n.push({item_id:i.rootID,parent_id:null,depth:o,left:a,right:2*(t(i.items,this.element).length+1)}),a++),t(this.element).children(i.items).each(function(){a=s(this,o+1,a)}),n=n.sort(function(t,e){return t.left-e.left})},_clearEmpty:function(e){var s=this.options,i=t(e).children(s.listType);!i.length||i.children().length||s.doNotClear?s.isTree&&i.length&&i.children().length&&i.is(":visible")?t(e).removeClass(s.leafClass).addClass(s.branchClass+" "+s.expandedClass):s.isTree&&i.length&&i.children().length&&!i.is(":visible")&&t(e).removeClass(s.leafClass).addClass(s.branchClass+" "+s.collapsedClass):(s.isTree&&t(e).removeClass(s.branchClass+" "+s.expandedClass).addClass(s.leafClass),i.remove())},_getLevel:function(t){var e=1;if(this.options.listType)for(var s=t.closest(this.options.listType);s&&s.length>0&&!s.is(".ui-sortable");)e++,s=s.parent().closest(this.options.listType);return e},_getChildLevels:function(e,s){var i=this,o=this.options,n=0;return s=s||0,t(e).children(o.listType).children(o.items).each(function(t,e){n=Math.max(i._getChildLevels(e,s+1),n)}),s?n+1:n},_isAllowed:function(t,e,s){var i=this.options,o=this.placeholder.closest(".ui-sortable").nestedSortable("option","maxLevels"),n=this.currentItem.parent().parent(),a=i.disableParentChange&&(null!==t&&!n.is(t)||null===t&&n.is("li"));a||!i.isAllowed(this.placeholder,t,this.currentItem)?(this.placeholder.addClass(i.errorClass),this.beyondMaxLevels=s>o&&0!=o?s-o:1):s>o&&0!=o?(this.placeholder.addClass(i.errorClass),this.beyondMaxLevels=s-o):(this.placeholder.removeClass(i.errorClass),this.beyondMaxLevels=0)}})),t.mjs.nestedSortable.prototype.options=t.extend({},t.ui.sortable.prototype.options,t.mjs.nestedSortable.prototype.options)}),!function(t){function e(t,e){if(!(t.originalEvent.touches.length>1)){t.preventDefault();var s=t.originalEvent.changedTouches[0],i=document.createEvent("MouseEvents");i.initMouseEvent(e,!0,!0,window,1,s.screenX,s.screenY,s.clientX,s.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(i)}}if(t.support.touch="ontouchend"in document,t.support.touch){var s,i=t.ui.mouse.prototype,o=i._mouseInit,n=i._mouseDestroy;i._touchStart=function(t){var i=this;!s&&i._mouseCapture(t.originalEvent.changedTouches[0])&&(s=!0,i._touchMoved=!1,e(t,"mouseover"),e(t,"mousemove"),e(t,"mousedown"))},i._touchMove=function(t){s&&(this._touchMoved=!0,e(t,"mousemove"))},i._touchEnd=function(t){s&&(e(t,"mouseup"),e(t,"mouseout"),this._touchMoved||e(t,"click"),s=!1)},i._mouseInit=function(){var e=this;e.element.bind({touchstart:t.proxy(e,"_touchStart"),touchmove:t.proxy(e,"_touchMove"),touchend:t.proxy(e,"_touchEnd")}),o.call(e)},i._mouseDestroy=function(){var e=this;e.element.unbind({touchstart:t.proxy(e,"_touchStart"),touchmove:t.proxy(e,"_touchMove"),touchend:t.proxy(e,"_touchEnd")}),n.call(e)}}}(jQuery),jQuery(function(t){function e(e){var i=t(e.placeholder).parents("ol").length,o=t(".sortable").width(),n=40*i-40,a=o-n;t(e.placeholder).width(a).css("margin-left",n+"px"),s(e)}function s(e){var s=t(e.placeholder).parent("ol");t(s).is(":visible")||t(s).show()}function i(){t(".child-toggle").each(function(){var e=t(this).parent(".row").parent("li");if(t(e).children("ol").length>0){var s=t(e).children("ol:visible").length>0?"np-icon-arrow-down":"np-icon-arrow-right";t(this).html('<a href="#"><i class="'+s+'"></i></a>')}else t(this).empty()})}function o(){t("#np-error").hide(),t("#nested-loading").show(),list=t("ol.sortable").nestedSortable("toHierarchy",{startDepthCount:0}),t.ajax({url:ajaxurl,type:"post",datatype:"json",data:{action:"npsort",nonce:nestedpages.np_nonce,list:list},success:function(e){"error"===e.status?(t("#np-error").text(e.message).show(),t("#nested-loading").hide()):(t("#nested-loading").hide(),console.log(e))}})}function n(e){{var s={id:t(e).attr("data-id"),title:t(e).attr("data-title"),slug:t(e).attr("data-slug"),author:t(e).attr("data-author"),cs:t(e).attr("data-commentstatus"),status:t(e).attr("data-status"),template:t(e).attr("data-template"),month:t(e).attr("data-month"),day:t(e).attr("data-day"),year:t(e).attr("data-year"),hour:t(e).attr("data-hour"),minute:t(e).attr("data-minute")},i=t(".quick-edit-form").clone().appendTo(t(e).closest(".row").parent("li"));t(i).siblings(".row").hide()}a(i,s)}function a(e,s){t(e).find(".np_id").val(s.id),t(e).find(".np_title").val(s.title),t(e).find(".np_slug").val(s.slug),t(e).find(".np_author select").val(s.author),t(e).find(".np_template").val(s.template),t(e).find(".np_status").val(s.status),"open"===s.cs&&t(e).find(".np_cs").prop("checked","checked"),t(e).find('select[name="mm"]').val(s.month),t(e).find('input[name="jj"]').val(s.day),t(e).find('input[name="aa"]').val(s.year),t(e).find('input[name="hh"]').val(s.hour),t(e).find('input[name="mn"]').val(s.minute),t(e).show()}function l(){t(".np-quickedit-error").hide(),t(".sortable .quick-edit").remove(),t(".row").show()}function r(e){t(".np-quickedit-error").hide(),t.ajax({url:ajaxurl,type:"post",datatype:"json",data:t(e).serialize()+"&action=npquickedit&nonce="+nestedpages.np_nonce,success:function(s){"error"===s.status?(d(e),t(e).find(".np-quickedit-error").text(s.message).show()):(d(e),c(e),h(e,s.post_data))}})}function h(e,s){var i=t(e).closest(".page-row");t(i).find(".title").text(s.post_title);var o=t(i).find(".np-quick-edit");t(o).attr("data-id",s.post_id),t(o).attr("data-template",s.page_template),t(o).attr("data-title",s.post_title),t(o).attr("data-slug",s.post_name),t(o).attr("data-commentstatus",s.comment_status),t(o).attr("data-status",s._status),t(o).attr("data-author",s.post_author),t(o).attr("data-month",s.mm),t(o).attr("data-day",s.jj),t(o).attr("data-year",s.aa),t(o).attr("data-hour",s.hh),t(o).attr("data-minute",s.mn)}function d(e){t(e).find(".np-save-quickedit").removeAttr("disabled"),t(e).find(".np-qe-loading").hide()}function c(e){var s=t(e).closest(".page-row").find(".row").addClass("np-updated");t(e).hide(),t(s).show(),setTimeout(function(){t(s).addClass("np-updated-show")},1500)}t(document).ready(function(){i()}),t(document).on("click",".child-toggle a",function(e){e.preventDefault();var s=t(this).parent(".child-toggle").parent(".row").siblings("ol");t(this).find("i").toggleClass("np-icon-arrow-down").toggleClass("np-icon-arrow-right"),t(s).toggle()}),t(document).on("click",".nestedpages-toggleall a",function(e){e.preventDefault(),"closed"==t(this).attr("data-toggle")?(t(".nestedpages ol li ol").show(),t(this).attr("data-toggle","opened"),t(this).text("Collapse Pages"),t(".child-toggle i").removeClass("np-icon-arrow-right").addClass("np-icon-arrow-down"),l()):(t(".nestedpages ol li ol").hide(),t(this).attr("data-toggle","closed"),t(this).text("Expand Pages"),t(".child-toggle i").removeClass("np-icon-arrow-down").addClass("np-icon-arrow-right"),l())}),t(document).on("click",".np-toggle-edit",function(e){e.preventDefault();var s=t(this).siblings(".action-buttons");t(s).is(":visible")?(t(this).removeClass("active"),t(s).hide()):(t(this).addClass("active"),t(s).show())});var p=function(){var t=0;return function(e,s){clearTimeout(t),t=setTimeout(e,s)}}();t(window).resize(function(){p(function(){t(".action-buttons").removeAttr("style"),t(".np-toggle-edit").removeClass("active")},500)}),t(document).ready(function(){t(".sortable").nestedSortable({items:"li",toleranceElement:"> .row",handle:".handle",placeholder:"ui-sortable-placeholder",start:function(t,e){e.placeholder.height(e.item.height())},sort:function(t,s){e(s)},stop:function(){setTimeout(function(){i()},100),o()},update:function(){}})}),t(document).on("click",".np-quick-edit",function(e){e.preventDefault(),l(),n(t(this))}),t(document).on("click",".np-cancel-quickedit",function(e){var s=t(this).parents(".page-row");l(s),e.preventDefault()}),t(document).on("click",".np-save-quickedit",function(e){e.preventDefault(),t(".row").removeClass("np-updated").removeClass("np-updated-show");var s=t(this).parents("form");t(this).attr("disabled","disabled"),t(s).find(".np-qe-loading").show(),r(s)})});