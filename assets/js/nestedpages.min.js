jQuery(function(t){function e(){var e=t(".nplist");t(".page-row").removeClass("no-border"),t.each(e,function(){t(this).find(".page-row:visible:first").addClass("no-border")})}function n(e){var n=t(e.placeholder).parents("ol").length,i=t(".sortable").width(),s=40*n-40,o=i-s;t(e.placeholder).width(o).css("margin-left",s+"px"),a(e)}function a(e){var n=t(e.placeholder).parent("ol");t(n).is(":visible")||t(n).show()}function s(){t(".child-toggle").each(function(){var e=t(this).parent(".row").parent("li");if(t(e).children("ol").length>0){var n=t(e).children("ol:visible").length>0?"np-icon-arrow-down":"np-icon-arrow-right";t(this).html('<a href="#"><i class="'+n+'"></i></a>')}else t(this).empty()})}function o(){t("#np-error").hide(),t("#nested-loading").show();var e=t(".np-sync-menu").is(":checked")?"sync":"nosync";list=t("ol.sortable").nestedSortable("toHierarchy",{startDepthCount:0}),t.ajax({url:ajaxurl,type:"post",datatype:"json",data:{action:"npsort",nonce:nestedpages.np_nonce,list:list,syncmenu:e},success:function(e){"error"===e.status?(t("#np-error").text(e.message).show(),t("#nested-loading").hide()):t("#nested-loading").hide()}})}function r(e){t.ajax({url:ajaxurl,type:"post",datatype:"json",data:{action:"npsyncmenu",nonce:nestedpages.np_nonce,syncmenu:e},success:function(t){"error"===t.status&&alert("There was an error saving the sync setting.")}})}function d(e){var n={id:t(e).attr("data-id"),title:t(e).attr("data-title"),slug:t(e).attr("data-slug"),author:t(e).attr("data-author"),cs:t(e).attr("data-commentstatus"),status:t(e).attr("data-status"),template:t(e).attr("data-template"),month:t(e).attr("data-month"),day:t(e).attr("data-day"),year:t(e).attr("data-year"),hour:t(e).attr("data-hour"),minute:t(e).attr("data-minute"),navstatus:t(e).attr("data-navstatus"),npstatus:t(e).attr("data-np-status"),navtitle:t(e).attr("data-navtitle")},a=t(e).closest(".row").parent("li");n.taxonomies=[];var s=t(a).attr("class").split(/\s+/);for(i=0;i<s.length;i++)"in-"===s[i].substring(0,3)&&n.taxonomies.push(s[i]);if(t(a).children("ol").length>0)var o=t(a).children("ol"),r=t(".quick-edit-form").clone().insertBefore(o);else var r=t(".quick-edit-form").clone().appendTo(a);t(r).siblings(".row").hide();c(r,n)}function c(e,n){if(t(e).find(".np_id").val(n.id),t(e).find(".np_title").val(n.title),t(e).find(".np_slug").val(n.slug),t(e).find(".np_author select").val(n.author),t(e).find(".np_template").val(n.template),t(e).find(".np_status").val(n.status),t(e).find(".np_nav_title").val(n.navtitle),"open"===n.cs&&t(e).find(".np_cs").prop("checked","checked"),"hide"===n.npstatus?t(e).find(".np_status").prop("checked","checked"):t(e).find(".np_status").removeAttr("checked"),"hide"===n.navstatus?t(e).find(".np_nav_status").prop("checked","checked"):t(e).find(".np_nav_status").removeAttr("checked"),t(e).find('select[name="mm"]').val(n.month),t(e).find('input[name="jj"]').val(n.day),t(e).find('input[name="aa"]').val(n.year),t(e).find('input[name="hh"]').val(n.hour),t(e).find('input[name="mn"]').val(n.minute),n.hasOwnProperty("taxonomies")){var a=n.taxonomies;for(i=0;i<a.length;i++){var s="#"+a[i];t(e).find(s).prop("checked","checked")}}t(e).show()}function l(){t(".np-quickedit-error").hide(),t(".sortable .quick-edit").remove(),t(".row").show()}function u(e){t(".np-quickedit-error").hide();var n=t(".np-sync-menu").is(":checked")?"sync":"nosync";t.ajax({url:ajaxurl,type:"post",datatype:"json",data:t(e).serialize()+"&action=npquickedit&nonce="+nestedpages.np_nonce+"&syncmenu="+n,success:function(n){"error"===n.status?(g(e),t(e).find(".np-quickedit-error").text(n.message).show()):(g(e),p(e,n.post_data),m(e))}})}function p(e,n){var a=t(e).parent(".quick-edit").siblings(".row");t(a).find(".title").text(n.post_title);var i=t(a).find(".status");t(i).text("publish"!==n._status&&"future"!==n._status?"("+n._status+")":"");var s=t(a).find(".nav-status");t(s).text("hide"==n.nav_status?"(Hidden)":"");var o=t(a).parent("li");"hide"==n.np_status?(t(o).addClass("np-hide"),t(a).find(".status").after('<i class="np-icon-eye-blocked"></i>')):(t(o).removeClass("np-hide"),t(a).find(".np-icon-eye-blocked").remove());var r=t(a).find(".np-quick-edit");t(r).attr("data-id",n.post_id),t(r).attr("data-template",n.page_template),t(r).attr("data-title",n.post_title),t(r).attr("data-slug",n.post_name),t(r).attr("data-commentstatus",n.comment_status),t(r).attr("data-status",n._status),t(r).attr("data-author",n.post_author),t(r).attr("data-navstatus",n.nav_status),t(r).attr("data-np-status",n.np_status),t(r).attr("data-navtitle",n.np_nav_title),t(r).attr("data-month",n.mm),t(r).attr("data-day",n.jj),t(r).attr("data-year",n.aa),t(r).attr("data-hour",n.hh),t(r).attr("data-minute",n.mn),h(o),f(o,n),v(o,n)}function h(e){taxonomies=[];var n=t(e).attr("class").split(/\s+/);for(i=0;i<n.length;i++)"in-"===n[i].substring(0,3)&&t(e).removeClass(n[i])}function f(e,n){if(n.hasOwnProperty("post_category")){var a=n.post_category;for(i=0;i<a.length;i++){var s="in-category-"+a[i];t(e).addClass(s)}}}function v(e,n){if(n.hasOwnProperty("tax_input")){var a=n.tax_input;t.each(a,function(n,a){for(i=0;i<a.length;i++){var s="in-"+n+"-"+a[i];t(e).addClass(s)}})}}function g(e){t(e).find(".np-save-quickedit").removeAttr("disabled"),t(e).find(".np-qe-loading").hide()}function m(n){var a=t(n).parent(".quick-edit").siblings(".row");t(a).addClass("np-updated"),t(a).show(),t(n).parent(".quick-edit").remove(),e(),setTimeout(function(){t(a).addClass("np-updated-show")},1500)}function k(e){var n={id:t(e).attr("data-id"),url:t(e).attr("data-url"),title:t(e).attr("data-title"),status:t(e).attr("data-status"),navstatus:t(e).attr("data-navstatus"),npstatus:t(e).attr("data-np-status"),linktarget:t(e).attr("data-linktarget")},a=t(e).closest(".row").parent("li");if(t(a).children("ol").length>0)var i=t(a).children("ol"),s=t(".quick-edit-form-redirect").clone().insertBefore(i);else var s=t(".quick-edit-form-redirect").clone().appendTo(a);t(s).siblings(".row").hide();t(s).show(),_(s,n)}function _(e,n){t(e).find(".np_id").val(n.id),t(e).find(".np_title").val(n.title),t(e).find(".np_author select").val(n.author),t(e).find(".np_status").val(n.status),t(e).find(".np_content").val(n.url),"hide"===n.npstatus?t(e).find(".np_status").prop("checked","checked"):t(e).find(".np_status").removeAttr("checked"),"hide"===n.navstatus?t(e).find(".np_nav_status").prop("checked","checked"):t(e).find(".np_nav_status").removeAttr("checked"),"_blank"===n.linktarget?t(e).find(".link_target").prop("checked","checked"):t(e).find(".link_target").removeAttr("checked"),t(e).show()}function w(e){t(".np-quickedit-error").hide();var n=t(".np-sync-menu").is(":checked")?"sync":"nosync";t.ajax({url:ajaxurl,type:"post",datatype:"json",data:t(e).serialize()+"&action=npquickeditredirect&nonce="+nestedpages.np_nonce+"&syncmenu="+n,success:function(n){"error"===n.status?(g(e),t(e).find(".np-quickedit-error").text(n.message).show()):(g(e),y(e,n.post_data),m(e))}})}function y(e,n){var a=t(e).parent(".quick-edit").siblings(".row");t(a).find(".title").text(n.post_title);var i=t(a).find(".status");t(i).text("publish"!==n._status&&"future"!==n._status?"("+n._status+")":"");var s=t(a).find(".nav-status");t(s).text("hide"==n.nav_status?"(Hidden)":"");var o=t(a).parent("li");"hide"==n.np_status?(t(o).addClass("np-hide"),t(a).find(".status").after('<i class="np-icon-eye-blocked"></i>')):(t(o).removeClass("np-hide"),t(a).find(".np-icon-eye-blocked").remove());var r=t(a).find(".np-quick-edit-redirect");t(r).attr("data-id",n.post_id),t(r).attr("data-title",n.post_title),t(r).attr("data-url",n.post_content),t(r).attr("data-status",n._status),t(r).attr("data-navstatus",n.nav_status),t(r).attr("data-np-status",n.np_status),t(r).attr("data-linktarget",n.link_target)}function b(){t(".np-link-loading").hide(),t(".np-save-link").removeAttr("disabled")}function x(){t(".np-new-link-error").hide();var e=t(".np-new-link-form").serialize(),n=t(".np-sync-menu").is(":checked")?"sync":"nosync";t.ajax({url:ajaxurl,type:"post",datatype:"json",data:e+"&action=npnewredirect&nonce="+nestedpages.np_nonce+"&syncmenu="+n,success:function(e){console.log(e),"error"===e.status?(b(),t(".np-new-link-error").text(e.message).show()):b()}})}function C(){var e=[],n=t(".page-row:visible");return t.each(n,function(){var n=t(this).attr("id");e.push(n.replace("menuItem_",""))}),e}function q(){var e=C();t.ajax({url:ajaxurl,type:"post",datatype:"json",data:{action:"npnesttoggle",nonce:nestedpages.np_nonce,ids:e},success:function(t){"success"!==t.status&&console.log("There was an error saving toggled pages.")}})}t(document).ready(function(){s(),e()}),t(document).on("click",".child-toggle a",function(n){n.preventDefault();var a=t(this).parent(".child-toggle").parent(".row").siblings("ol");t(this).find("i").toggleClass("np-icon-arrow-down").toggleClass("np-icon-arrow-right"),t(a).toggle(),e(),q()}),t(document).on("click",".nestedpages-toggleall a",function(n){n.preventDefault(),"closed"==t(this).attr("data-toggle")?(t(".nestedpages ol li ol").show(),t(this).attr("data-toggle","opened"),t(this).text(nestedpages.collapse_text),t(".child-toggle i").removeClass("np-icon-arrow-right").addClass("np-icon-arrow-down"),l(),e()):(t(".nestedpages ol li ol").hide(),t(this).attr("data-toggle","closed"),t(this).text(nestedpages.expand_text),t(".child-toggle i").removeClass("np-icon-arrow-down").addClass("np-icon-arrow-right"),l(),e()),q()}),t(document).on("click",".np-toggle-hidden",function(n){n.preventDefault();var a=t(this).attr("href");"show"===a?(t(this).attr("href","hide"),t(this).text(nestedpages.show_hidden),t(".np-hide").removeClass("shown").hide(),e()):(t(this).attr("href","show"),t(this).text(nestedpages.hide_hidden),t(".np-hide").addClass("shown").show(),e())}),t(document).on("click",".np-toggle-publish",function(e){e.preventDefault();var n=t(this).attr("href");t(".np-toggle-publish").removeClass("active"),t(this).addClass("active"),"#published"==n?(t(".nplist .page-row").hide(),t(".nplist .published").show()):t(".nplist .page-row").show()}),t(document).on("click",".np-toggle-edit",function(e){e.preventDefault();var n=t(this).siblings(".action-buttons");t(n).is(":visible")?(t(this).removeClass("active"),t(n).hide()):(t(this).addClass("active"),t(n).show())});var j=function(){var t=0;return function(e,n){clearTimeout(t),t=setTimeout(e,n)}}();t(window).resize(function(){j(function(){t(".action-buttons").removeAttr("style"),t(".np-toggle-edit").removeClass("active")},500)}),t(document).ready(function(){t(".sortable").not(".no-sort").nestedSortable({items:"li",toleranceElement:"> .row",handle:".handle",placeholder:"ui-sortable-placeholder",start:function(t,e){e.placeholder.height(e.item.height())},sort:function(t,e){n(e)},stop:function(){setTimeout(function(){s(),e()},100),o()},update:function(){}})}),t(".np-sync-menu").on("change",function(){var e=t(this).is(":checked")?"sync":"nosync";r(e)}),t(document).on("click",".np-quick-edit",function(e){e.preventDefault(),l(),d(t(this))}),t(document).on("click",".np-cancel-quickedit",function(e){var n=t(this).parents(".page-row");l(n),e.preventDefault()}),t(document).on("click",".np-save-quickedit",function(e){e.preventDefault(),t(".row").removeClass("np-updated").removeClass("np-updated-show");var n=t(this).parents("form");t(this).attr("disabled","disabled"),t(n).find(".np-qe-loading").show(),u(n)}),t(document).on("click",".np-toggle-taxonomies",function(){t(this).parents("form").find(".np-taxonomies").toggle()}),t(document).on("click",".np-quick-edit-redirect",function(e){e.preventDefault(),l(),k(t(this))}),t(document).on("click",".np-save-quickedit-redirect",function(e){e.preventDefault(),t(".row").removeClass("np-updated").removeClass("np-updated-show");var n=t(this).parents("form");t(this).attr("disabled","disabled"),t(n).find(".np-qe-loading").show(),w(n)}),t(document).on("click",".open-redirect-modal",function(e){e.preventDefault();var n=t(this).attr("data-parentid");t(".np-modal-form").find("input").val(""),t(".np-modal-form").find(".parent_id").val(n),t("#np-link-modal").modal("show")}),t(document).on("click",".np-save-link",function(e){e.preventDefault(),t(".np-new-link-error").hide(),t(".np-link-loading").show(),t(this).attr("disabled","disabled"),x()})});