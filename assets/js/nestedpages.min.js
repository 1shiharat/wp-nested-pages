jQuery(function(t){function e(){var e=t(".nplist");t(".page-row").removeClass("no-border"),t.each(e,function(){t(this).find(".page-row:visible:first").addClass("no-border")})}function a(e){var a=t(e.placeholder).parents("ol").length,i=t(".sortable").width(),s=40*a-40,o=i-s;t(e.placeholder).width(o).css("margin-left",s+"px"),n(e)}function n(e){var a=t(e.placeholder).parent("ol");t(a).is(":visible")||t(a).show()}function s(){t(".child-toggle").each(function(){var e=t(this).parent(".row").parent("li");if(t(e).children("ol").length>0){var a=t(e).children("ol:visible").length>0?"np-icon-arrow-down":"np-icon-arrow-right";t(this).html('<a href="#"><i class="'+a+'"></i></a>')}else t(this).empty()})}function o(){t("#np-error").hide(),t("#nested-loading").show();var e=t(".np-sync-menu").is(":checked")?"sync":"nosync";list=t("ol.sortable").nestedSortable("toHierarchy",{startDepthCount:0}),t.ajax({url:ajaxurl,type:"post",datatype:"json",data:{action:"npsort",nonce:nestedpages.np_nonce,list:list,syncmenu:e},success:function(e){"error"===e.status?(t("#np-error").text(e.message).show(),t("#nested-loading").hide()):t("#nested-loading").hide()}})}function r(e){t.ajax({url:ajaxurl,type:"post",datatype:"json",data:{action:"npsyncmenu",nonce:nestedpages.np_nonce,syncmenu:e},success:function(t){"error"===t.status&&alert("There was an error saving the sync setting.")}})}function d(e){var a={id:t(e).attr("data-id"),title:t(e).attr("data-title"),slug:t(e).attr("data-slug"),author:t(e).attr("data-author"),cs:t(e).attr("data-commentstatus"),status:t(e).attr("data-status"),template:t(e).attr("data-template"),month:t(e).attr("data-month"),day:t(e).attr("data-day"),year:t(e).attr("data-year"),hour:t(e).attr("data-hour"),minute:t(e).attr("data-minute"),navstatus:t(e).attr("data-navstatus"),npstatus:t(e).attr("data-np-status"),navtitle:t(e).attr("data-navtitle"),navtitleattr:t(e).attr("data-navtitleattr"),navcss:t(e).attr("data-navcss"),linktarget:t(e).attr("data-linktarget"),password:t(e).attr("data-password")},n=t(e).closest(".row").parent("li");a.h_taxonomies=[],a.f_taxonomies=[];var s=t(n).attr("class").split(/\s+/);for(i=0;i<s.length;i++)"in-"===s[i].substring(0,3)&&a.h_taxonomies.push(s[i]),"inf-"===s[i].substring(0,4)&&a.f_taxonomies.push(s[i]);if(t(n).children("ol").length>0)var o=t(n).children("ol"),r=t(".quick-edit-form").clone().insertBefore(o);else var r=t(".quick-edit-form").clone().appendTo(n);t(r).siblings(".row").hide();l(r,a)}function l(e,a){if(t(e).find(".page_id").html("<em>Page ID:</em> "+a.id),t(e).find(".np_id").val(a.id),t(e).find(".np_title").val(a.title),t(e).find(".np_slug").val(a.slug),t(e).find(".np_author select").val(a.author),t(e).find(".np_template").val(a.template),t(e).find(".np_status").val(a.status),t(e).find(".np_nav_title").val(a.navtitle),t(e).find(".np_title_attribute").val(a.navtitleattr),t(e).find(".np_nav_css_classes").val(a.navcss),t(e).find(".post_password").val(a.password),"open"===a.cs&&t(e).find(".np_cs").prop("checked","checked"),"private"===a.status&&(t(e).find(".post_password").prop("readonly",!0),t(e).find(".keep_private").prop("checked",!0)),"hide"===a.npstatus?t(e).find(".np_status").prop("checked","checked"):t(e).find(".np_status").removeAttr("checked"),"hide"===a.navstatus?t(e).find(".np_nav_status").prop("checked","checked"):t(e).find(".np_nav_status").removeAttr("checked"),"_blank"===a.linktarget?t(e).find(".link_target").prop("checked","checked"):t(e).find(".link_target").removeAttr("checked"),"private"===a.status&&t(e).find(".np_status").val("publish"),t(e).find('select[name="mm"]').val(a.month),t(e).find('input[name="jj"]').val(a.day),t(e).find('input[name="aa"]').val(a.year),t(e).find('input[name="hh"]').val(a.hour),t(e).find('input[name="mn"]').val(a.minute),a.hasOwnProperty("h_taxonomies")){var n=a.h_taxonomies;for(i=0;i<n.length;i++){var s="#"+n[i];t(e).find(s).prop("checked","checked")}}f(),t(e).show(),a.hasOwnProperty("f_taxonomies")&&(c(a.f_taxonomies),h(e))}function c(t){var e={};for(i=0;i<t.length;i++){var a=t[i].split("-"),n=a.indexOf("nps"),s=a.splice(n+1);s=s.join("-");var o=t[i].split("-").splice(0,n);o.shift("inf");var r=o.join("-");r in e||(e[r]=[]);var d=e[r];d.push(s)}p(e)}function p(e){t.ajax({url:ajaxurl,type:"post",datatype:"json",data:{action:"gettax",nonce:nestedpages.np_nonce,terms:e},success:function(t){u(t.terms)}})}function u(e){t.each(e,function(e,a){var n=t("#"+e);t(n).val(a.join(","))})}function h(e){var a=t(e).find("[data-autotag]");t.each(a,function(){var e=t(this).attr("data-taxonomy");t(this).suggest(ajaxurl+"?action=ajax-tag-search&tax="+e,{multiple:!0,multipleSep:","})})}function v(){t(".np-quickedit-error").hide(),m(),t(".sortable .quick-edit").remove(),t(".row").show()}function f(){t("body").append('<div class="np-inline-overlay"></div>'),setTimeout(function(){t(".np-inline-overlay").addClass("active")},50)}function m(){t(".np-inline-overlay").removeClass("active").remove()}function g(e){t(".np-quickedit-error").hide();var a=t(".np-sync-menu").is(":checked")?"sync":"nosync";t.ajax({url:ajaxurl,type:"post",datatype:"json",data:t(e).serialize()+"&action=npquickedit&nonce="+nestedpages.np_nonce+"&syncmenu="+a,success:function(a){console.log(a),"error"===a.status?(x(e),t(e).find(".np-quickedit-error").text(a.message).show()):(x(e),_(e,a.post_data),C(e))}})}function _(e,a){var n=t(e).parent(".quick-edit").siblings(".row");t(n).find(".title").text(a.post_title);var i=t(n).find(".status");if(t(i).text("publish"!==a._status&&"future"!==a._status?"("+a._status+")":"private"===a.keep_private?"("+a.keep_private+")":""),""!==a.post_password){var s=t(i).text();s+=' <i class="np-icon-lock"></i>',t(i).html(s)}var o=t(n).find(".nav-status");t(o).text("hide"==a.nav_status?"(Hidden)":"");var r=t(n).parent("li");"hide"==a.np_status?(t(r).addClass("np-hide"),t(n).find(".status").after('<i class="np-icon-eye-blocked"></i>')):(t(r).removeClass("np-hide"),t(n).find(".np-icon-eye-blocked").remove());var d=t(n).find(".np-quick-edit");t(d).attr("data-id",a.post_id),t(d).attr("data-template",a.page_template),t(d).attr("data-title",a.post_title),t(d).attr("data-slug",a.post_name),t(d).attr("data-commentstatus",a.comment_status),t(d).attr("data-status",a._status),"private"===a.keep_private&&t(d).attr("data-status","private"),t(d).attr("data-author",a.post_author),t(d).attr("data-np-status",a.np_status),t(d).attr("data-password",a.post_password),t(d).attr("data-navstatus",a.nav_status),t(d).attr("data-navtitle",a.np_nav_title),t(d).attr("data-linktarget",a.link_target),t(d).attr("data-navtitleattr",a.np_title_attribute),t(d).attr("data-navcss",a.np_nav_css_classes),t(d).attr("data-month",a.mm),t(d).attr("data-day",a.jj),t(d).attr("data-year",a.aa),t(d).attr("data-hour",a.hh),t(d).attr("data-minute",a.mn),k(r),w(r,a),y(r,a),b(r,a)}function k(e){taxonomies=[];var a=t(e).attr("class").split(/\s+/);for(i=0;i<a.length;i++)"in-"===a[i].substring(0,3)&&t(e).removeClass(a[i]),"inf-"===a[i].substring(0,4)&&t(e).removeClass(a[i])}function w(e,a){if(a.hasOwnProperty("post_category")){var n=a.post_category;for(i=0;i<n.length;i++){var s="in-category-"+n[i];t(e).addClass(s)}}}function y(e,a){if(a.hasOwnProperty("tax_input")){var n=a.tax_input;t.each(n,function(a,n){for(i=0;i<n.length;i++){var s="in-"+a+"-"+n[i];t(e).addClass(s)}})}}function b(e,a){if(a.hasOwnProperty("flat_tax")){var n=a.flat_tax;t.each(n,function(a,n){for(i=0;i<n.length;i++){var s="inf-"+a+"-nps-"+n[i];t(e).addClass(s)}})}}function x(e){t(e).find(".np-save-quickedit, .np-save-quickedit-redirect, .np-save-newchild").removeAttr("disabled"),t(e).find(".np-qe-loading").hide()}function C(a){var n=t(a).parent(".quick-edit").siblings(".row");t(n).addClass("np-updated"),t(n).show(),t(a).parent(".quick-edit").remove(),m(),e(),setTimeout(function(){t(n).addClass("np-updated-show")},1500)}function j(e){var a={id:t(e).attr("data-id"),url:t(e).attr("data-url"),title:t(e).attr("data-title"),status:t(e).attr("data-status"),navstatus:t(e).attr("data-navstatus"),npstatus:t(e).attr("data-np-status"),linktarget:t(e).attr("data-linktarget"),parentid:t(e).attr("data-parentid"),navtitleattr:t(e).attr("data-navtitleattr"),navcss:t(e).attr("data-navcss")},n=t(e).closest(".row").parent("li");if(t(n).children("ol").length>0)var i=t(n).children("ol"),s=t(".quick-edit-form-redirect").clone().insertBefore(i);else var s=t(".quick-edit-form-redirect").clone().appendTo(n);t(s).siblings(".row").hide();t(s).show(),q(s,a)}function q(e,a){t(e).find(".np_id").val(a.id),t(e).find(".np_title").val(a.title),t(e).find(".np_author select").val(a.author),t(e).find(".np_status").val(a.status),t(e).find(".np_content").val(a.url),t(e).find(".np_parent_id").val(a.parentid),t(e).find(".np_title_attribute").val(a.navtitleattr),t(e).find(".np_nav_css_classes").val(a.navcss),"hide"===a.npstatus?t(e).find(".np_status").prop("checked","checked"):t(e).find(".np_status").removeAttr("checked"),"hide"===a.navstatus?t(e).find(".np_nav_status").prop("checked","checked"):t(e).find(".np_nav_status").removeAttr("checked"),"_blank"===a.linktarget?t(e).find(".link_target").prop("checked","checked"):t(e).find(".link_target").removeAttr("checked"),f(),t(e).show()}function D(e){t(".np-quickedit-error").hide();var a=t(".np-sync-menu").is(":checked")?"sync":"nosync";t.ajax({url:ajaxurl,type:"post",datatype:"json",data:t(e).serialize()+"&action=npquickeditredirect&nonce="+nestedpages.np_nonce+"&syncmenu="+a,success:function(a){console.log(a),"error"===a.status?(x(e),t(e).find(".np-quickedit-error").text(a.message).show()):(x(e),T(e,a.post_data),C(e))},error:function(){x(e),t(e).find(".np-quickedit-error").text("The form could not be saved at this time.").show()}})}function T(e,a){var n=t(e).parent(".quick-edit").siblings(".row");t(n).find(".title").html(a.post_title+' <i class="np-icon-link"></i>');var i=t(n).find(".status");t(i).text("publish"!==a._status&&"future"!==a._status?"("+a._status+")":"");var s=t(n).find(".nav-status");t(s).text("hide"==a.nav_status?"(Hidden)":"");var o=t(n).parent("li");"hide"==a.np_status?(t(o).addClass("np-hide"),t(n).find(".status").after('<i class="np-icon-eye-blocked"></i>')):(t(o).removeClass("np-hide"),t(n).find(".np-icon-eye-blocked").remove());var r=t(n).find(".np-quick-edit-redirect");t(r).attr("data-id",a.post_id),t(r).attr("data-title",a.post_title),t(r).attr("data-url",a.post_content),t(r).attr("data-status",a._status),t(r).attr("data-navstatus",a.nav_status),t(r).attr("data-np-status",a.np_status),t(r).attr("data-linktarget",a.link_target),t(r).attr("data-navtitleattr",a.np_title_attribute),t(r).attr("data-navcss",a.np_nav_css_classes)}function A(){t(".np-link-loading").hide(),t(".np-save-link").removeAttr("disabled")}function P(){t(".np-new-link-error").hide();var e=t(".np-new-link-form").serialize(),a=t(".np-sync-menu").is(":checked")?"sync":"nosync";t.ajax({url:ajaxurl,type:"post",datatype:"json",data:e+"&action=npnewredirect&nonce="+nestedpages.np_nonce+"&syncmenu="+a,success:function(e){console.log(e),"error"===e.status?(A(),t(".np-new-link-error").text(e.message).show()):(A(),O(e.post_data))}})}function O(e){var a='<li id="menuItem_'+e.id+'" class="page-row';"publish"===e._status&&(a+=" published"),a+='">',a+='<div class="row"><div class="child-toggle"></div><div class="row-inner"><i class="np-icon-sub-menu"></i><i class="handle np-icon-menu"></i><a href="'+e.np_link_content+'" class="page-link page-title" target="_blank"><span class="title">'+e.np_link_title+' <i class="np-icon-link"></i></span>',a+="publish"!==e._status?'<span class="status">'+e._status+"</span>":'<span class="status"></span>',"hide"===e.np_status&&(a+='<i class="np-icon-eye-blocked"></i>'),a+="hide"===e.nav_status?'<span class="nav-status">(Hidden)</span>':'<span class="nav-status"></span>',a+='</a><a href="#" class="np-toggle-edit"><i class="np-icon-pencil"></i></a><div class="action-buttons"><a href="#" class="np-btn np-quick-edit-redirect" ',a+='data-id="'+e.id+'"',a+='data-parentid="'+e.parent_id+'"',a+='data-title="'+e.np_link_title+'" ',a+='data-url="'+e.np_link_content+'" ',a+='data-status="'+e._status+'" ',a+='data-np-status="'+e.np_status+'" ',a+='data-navstatus="'+e.nav_status+'" ',a+='data-linktarget="'+e.link_target+'">',a+="Quick Edit</a>",a+="</div></div></div></li>","0"===e.parent_id?t(".nplist:first li:first").after(a):z(a,e),t("#np-link-modal").modal("hide");var n=t("#menuItem_"+e.id).find(".row");I(n)}function z(e,a){var n=t("#menuItem_"+a.parent_id);0===t(n).children("ol").length?(e='<ol class="sortable nplist" style="display:block;">'+e+"</ol>",t(n).append(e)):t(n).find("ol:first").prepend(e),s(),S()}function I(a){t(a).addClass("np-updated"),e(),setTimeout(function(){t(a).addClass("np-updated-show")},1500)}function H(){var e=[],a=t(".page-row:visible");return t.each(a,function(){var a=t(this).attr("id");e.push(a.replace("menuItem_",""))}),e}function S(){var e=H();t.ajax({url:ajaxurl,type:"post",datatype:"json",data:{action:"npnesttoggle",nonce:nestedpages.np_nonce,ids:e},success:function(t){"success"!==t.status&&console.log("There was an error saving toggled pages.")}})}function B(){t(".np-newchild-error").hide(),m(),t(".sortable .new-child").remove(),t(".row").show()}function E(e){var a=t(e).closest(".row").parent("li");if(t(a).children("ol").length>0)var n=t(a).children("ol"),i=t(".new-child-form").clone().insertBefore(n);else var i=t(".new-child-form").clone().appendTo(a);t(i).siblings(".row").hide();f(),t(i).find(".parent_name").html("<em>Parent:</em> "+t(e).attr("data-parentname")),t(i).find(".page_parent_id").val(t(e).attr("data-id")),t(i).show()}function Q(e){{var a='<li><i class="handle np-icon-menu"></i><div class="form-control new-child-row"><label>'+nestedpages.title+'</label><div><input type="text" name="post_title[]" class="np_title" placeholder="'+nestedpages.page_title+'" value="" /><a href="#" class="button-secondary np-remove-child">-</a></div></div></li>';t(e).siblings(".new-page-titles").append(a)}t(".new-page-titles").nestedSortable({items:"li",handle:".handle"})}function F(e){var a=t(e).find(t(".new-child-row")).length;a>0?(t(e).find("h3 strong").text(nestedpages.add_child_pages),t(e).find(".np-save-newchild").text(nestedpages.add_pages)):(t(e).find("h3 strong").text(nestedpages.add_child),t(e).find(".np-save-newchild").text(nestedpages.add_page))}function G(e){t(".np-quickedit-error").hide();var a=t(".np-sync-menu").is(":checked")?"sync":"nosync";t.ajax({url:ajaxurl,type:"post",datatype:"json",data:t(e).serialize()+"&action=npnewchild&nonce="+nestedpages.np_nonce+"&syncmenu="+a,success:function(a){console.log(a),"error"===a.status?(x(e),t(e).find(".np-quickedit-error").text(a.message).show()):x(e)},error:function(){x(e),t(e).find(".np-quickedit-error").text("The form could not be saved at this time.").show()}})}t(document).ready(function(){s(),e()}),t(document).on("click",".child-toggle a",function(a){a.preventDefault();var n=t(this).parent(".child-toggle").parent(".row").siblings("ol");t(this).find("i").toggleClass("np-icon-arrow-down").toggleClass("np-icon-arrow-right"),t(n).toggle(),e(),S()}),t(document).on("click",".nestedpages-toggleall a",function(a){a.preventDefault(),"closed"==t(this).attr("data-toggle")?(t(".nestedpages ol li ol").show(),t(this).attr("data-toggle","opened"),t(this).text(nestedpages.collapse_text),t(".child-toggle i").removeClass("np-icon-arrow-right").addClass("np-icon-arrow-down"),v(),e()):(t(".nestedpages ol li ol").hide(),t(this).attr("data-toggle","closed"),t(this).text(nestedpages.expand_text),t(".child-toggle i").removeClass("np-icon-arrow-down").addClass("np-icon-arrow-right"),v(),e()),S()}),t(document).on("click",".np-toggle-hidden",function(a){a.preventDefault();var n=t(this).attr("href");"show"===n?(t(this).attr("href","hide"),t(this).text(nestedpages.show_hidden),t(".np-hide").removeClass("shown").hide(),e()):(t(this).attr("href","show"),t(this).text(nestedpages.hide_hidden),t(".np-hide").addClass("shown").show(),e())}),t(".np-tabs a").on("click",function(e){e.preventDefault(),t(".np-tabs a").removeClass("active"),t(this).addClass("active");var a=t(this).attr("href");t(".np-tabbed-content").hide(),t(a).show()}),t(document).on("click",".np-toggle-publish",function(e){e.preventDefault();var a=t(this).attr("href");t(".np-toggle-publish").removeClass("active"),t(this).addClass("active"),"#published"==a?(t(".nplist .page-row").hide(),t(".nplist .published").show()):t(".nplist .page-row").show()}),t(document).on("click",".np-toggle-edit",function(e){e.preventDefault();var a=t(this).siblings(".action-buttons");t(a).is(":visible")?(t(this).removeClass("active"),t(a).hide()):(t(this).addClass("active"),t(a).show())});var J=function(){var t=0;return function(e,a){clearTimeout(t),t=setTimeout(e,a)}}();t(window).resize(function(){J(function(){t(".action-buttons").removeAttr("style"),t(".np-toggle-edit").removeClass("active")},500)}),t(document).ready(function(){t(".sortable").not(".no-sort").nestedSortable({items:"li",toleranceElement:"> .row",handle:".handle",placeholder:"ui-sortable-placeholder",start:function(t,e){e.placeholder.height(e.item.height())},sort:function(t,e){a(e)},stop:function(){setTimeout(function(){s(),e()},100),o()},update:function(){}})}),t(document).ready(function(){"1"===nestedpages.syncmenu&&r("sync")}),t(".np-sync-menu").on("change",function(){var e=t(this).is(":checked")?"sync":"nosync";r(e)}),t(document).on("click",".np-quick-edit",function(e){e.preventDefault(),v(),d(t(this))}),t(document).on("click",".np-inline-overlay",function(){v(),B()}),t(document).on("click",".np-cancel-quickedit",function(e){var a=t(this).parents(".page-row");v(a),e.preventDefault()}),t(document).on("click",".np-save-quickedit",function(e){e.preventDefault(),t(".row").removeClass("np-updated").removeClass("np-updated-show");var a=t(this).parents("form");t(this).attr("disabled","disabled"),t(a).find(".np-qe-loading").show(),g(a)}),t(document).on("click",".np-toggle-taxonomies",function(e){t(this).parents("form").find(".np-taxonomies").toggle(),e.preventDefault()}),t(document).on("click",".np-toggle-menuoptions",function(e){e.preventDefault(),t(this).parents("form").find(".np-menuoptions").toggle()}),t(document).on("change",".keep_private",function(){this.checked?t(".post_password").val("").prop("readonly",!0):t(".post_password").prop("readonly",!1)}),t(document).on("click",".np-quick-edit-redirect",function(e){e.preventDefault(),v(),j(t(this))}),t(document).on("click",".np-save-quickedit-redirect",function(e){e.preventDefault(),t(".row").removeClass("np-updated").removeClass("np-updated-show");var a=t(this).parents("form");t(this).attr("disabled","disabled"),t(a).find(".np-qe-loading").show(),D(a)}),t(document).on("click",".open-redirect-modal",function(e){e.preventDefault();var a=t(this).attr("data-parentid");t("#np-link-modal").find("input").val(""),t("#np-link-modal .parent_id").val(a),t("#np-add-link-title").text("0"===a?nestedpages.add_link:nestedpages.add_child_link),t("#np-link-modal").modal("show")}),t(document).on("click",".np-save-link",function(e){e.preventDefault(),t(".np-new-link-error").hide(),t(".np-link-loading").show(),t(this).attr("disabled","disabled"),P()}),t(document).on("click",".np-cancel-newchild",function(t){t.preventDefault(),B()}),t(document).on("click",".add-new-child",function(e){e.preventDefault(),E(t(this))}),t(document).on("click",".add-new-child-row",function(e){e.preventDefault(),Q(t(this));var a=t(this).parents("form");F(a)}),t(document).on("click",".np-remove-child",function(e){e.preventDefault();var a=t(this).parents("form");t(this).parents(".new-child-row").parent("li").remove(),F(a)}),t(document).on("click",".np-save-newchild",function(e){e.preventDefault(),t(this).prop("disabled","disabled");var a=t(this).parents("form");t(a).find(".np-qe-loading").show(),G(a)})});